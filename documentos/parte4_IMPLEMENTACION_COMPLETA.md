# Gu√≠a de Implementaci√≥n Completa - App de Cobranza

Este documento complementa `DATABASE_IMPLEMENTACION.md`, `ultimo_paso_database_imp.md` y `front_app.md`, explicando **exactamente qu√© te falta** para tener la aplicaci√≥n 100% operativa.

---

## üìã Tabla de Contenidos

1. [Estado Actual de Implementaci√≥n](#1-estado-actual-de-implementaci√≥n)
   - [Lo que YA tienes (siguiendo los 3 documentos)](#lo-que-ya-tienes-siguiendo-los-3-documentos)
     - [Base de Datos (100% ‚úÖ)](#base-de-datos-100-)
     - [Backend Core (80% ‚ö†Ô∏è)](#backend-core-80-)
     - [Frontend (60% ‚ö†Ô∏è)](#frontend-60-)
2. [Variables de Entorno Necesarias](#2-variables-de-entorno-necesarias)
3. [Datos Iniciales en la Base de Datos](#3-datos-iniciales-en-la-base-de-datos)
   - [A) Planes de Suscripci√≥n (REQUERIDO)](#a-planes-de-suscripci√≥n-requerido)
   - [B) Configuraciones Globales (Guardrails)](#b-configuraciones-globales-guardrails)
   - [C) Asignar Plan a Usuario (despu√©s de registro)](#c-asignar-plan-a-usuario-despu√©s-de-registro)
4. [P√°ginas Faltantes por Implementar](#4-p√°ginas-faltantes-por-implementar)
   - [CR√çTICAS (sin estas la app no es usable)](#cr√≠ticas-sin-estas-la-app-no-es-usable)
     - [A) P√°gina de Campa√±as](#a-p√°gina-de-campa√±as)
     - [B) P√°gina de Historial](#b-p√°gina-de-historial)
     - [C) P√°gina de Plantillas](#c-p√°gina-de-plantillas)
   - [IMPORTANTES (para app completa)](#importantes-para-app-completa)
     - [D) P√°gina de Deudor Individual](#d-p√°gina-de-deudor-individual)
     - [E) P√°gina de Billing/Suscripciones](#e-p√°gina-de-billingsuscripciones)
     - [F) P√°gina de Pagos (de deudas)](#f-p√°gina-de-pagos-de-deudas)
     - [G) P√°gina de Tel√©fono/Agentes](#g-p√°gina-de-tel√©fonoagentes)
     - [H) P√°gina de Profile](#h-p√°gina-de-profile)
   - [Resumen de p√°ginas](#resumen-de-p√°ginas)
5. [Archivos de Utilidades Faltantes](#5-archivos-de-utilidades-faltantes)
6. [Configuraci√≥n de Webhooks Externos](#6-configuraci√≥n-de-webhooks-externos)
   - [D) Verificaci√≥n de Webhooks](#d-verificaci√≥n-de-webhooks)
7. [Deployment y Producci√≥n](#7-deployment-y-producci√≥n)
   - [Gu√≠a m√≠nima (referencia)](#gu√≠a-m√≠nima-referencia)
   - [Paso 3: Configurar Dominio (Opcional)](#paso-3-configurar-dominio-opcional)
   - [Paso 4: Verificar que todo funciona](#paso-4-verificar-que-todo-funciona)
   - [Paso 5: Configurar Monitoreo (Opcional pero recomendado)](#paso-5-configurar-monitoreo-opcional-pero-recomendado)
     - [A) Sentry (errores)](#a-sentry-errores)
     - [B) Vercel Analytics](#b-vercel-analytics)
     - [C) Logs de Cron Job](#c-logs-de-cron-job)
8. [Plan de Implementaci√≥n por Fases](#8-plan-de-implementaci√≥n-por-fases)
   - [Fase 1: MVP Funcional (2-3 semanas)](#fase-1-mvp-funcional-2-3-semanas)
     - [Semana 1: Infraestructura](#semana-1-infraestructura)
     - [Semana 2: P√°ginas cr√≠ticas](#semana-2-p√°ginas-cr√≠ticas)
     - [Semana 3: Testing y ajustes](#semana-3-testing-y-ajustes)
   - [Fase 2: Producci√≥n Lista (2-3 semanas)](#fase-2-producci√≥n-lista-2-3-semanas)
     - [Semana 4: P√°ginas complementarias](#semana-4-p√°ginas-complementarias)
     - [Semana 5: M√≥dulo de llamadas](#semana-5-m√≥dulo-de-llamadas)
     - [Semana 6: Refinamiento](#semana-6-refinamiento)
   - [Fase 3: Mejoras y Escalabilidad (ongoing)](#fase-3-mejoras-y-escalabilidad-ongoing)
     - [Mejoras UX](#mejoras-ux)
     - [Optimizaciones](#optimizaciones)
     - [Analytics](#analytics)
     - [Integraciones](#integraciones)
9. [Checklist de Implementaci√≥n](#9-checklist-de-implementaci√≥n)
   - [Base de Datos (100%)](#base-de-datos-100-1)
   - [Configuraci√≥n Inicial (CR√çTICO)](#configuraci√≥n-inicial-cr√≠tico)
   - [Archivos de Utilidades (CR√çTICO)](#archivos-de-utilidades-cr√≠tico)
   - [Backend (CR√çTICO)](#backend-cr√≠tico)
   - [P√°ginas Cr√≠ticas (M√çNIMO VIABLE)](#p√°ginas-cr√≠ticas-m√≠nimo-viable)
   - [P√°ginas Importantes (COMPLETO)](#p√°ginas-importantes-completo)
   - [Webhooks Externos (CR√çTICO)](#webhooks-externos-cr√≠tico)
   - [Deploy (CR√çTICO)](#deploy-cr√≠tico)
   - [Testing](#testing)
   - [Mejoras Opcionales](#mejoras-opcionales)
10. [Resumen Final](#resumen-final)
    - [Con los 3 documentos implementados tendr√°s](#con-los-3-documentos-implementados-tendr√°s)
    - [Tiempo Estimado Total](#tiempo-estimado-total)
    - [Prioridad de Implementaci√≥n](#prioridad-de-implementaci√≥n)
11. [¬øNecesitas Ayuda?](#necesitas-ayuda)

---

## 1. Estado Actual de Implementaci√≥n

### ‚úÖ Lo que YA tienes (siguiendo los 3 documentos):

#### Base de Datos (100% ‚úÖ)
- ‚úÖ 20 tablas creadas (13 base + 6 llamadas + 1 auditor√≠a)
- ‚úÖ Funciones de normalizaci√≥n (RUT, tel√©fonos)
- ‚úÖ Triggers autom√°ticos
- ‚úÖ RLS y pol√≠ticas de seguridad
- ‚úÖ √çndices optimizados
- ‚úÖ M√≥dulo de llamadas completo

#### Backend Core (80% ‚ö†Ô∏è)
- ‚úÖ C√≥digo del job programado
- ‚úÖ C√≥digo de webhooks (Resend, ElevenLabs, Twilio)
- ‚úÖ L√≥gica de reintentos y backoff
- ‚úÖ Guardrails de validaci√≥n
- ‚úÖ Rate limiting
- ‚úÖ Integraci√≥n con ElevenLabs
- ‚úÖ Integraci√≥n con Resend
- ‚ö†Ô∏è Falta crear los archivos f√≠sicos

#### Frontend (60% ‚ö†Ô∏è)
- ‚úÖ Autenticaci√≥n completa (AuthContext, Protected, middleware)
- ‚úÖ Componentes UI de shadcn/ui
- ‚úÖ Layout y Sidebar
- ‚úÖ Ejemplos de Dashboard y Deudores
- ‚ö†Ô∏è Falta implementar el resto de p√°ginas
- ‚ö†Ô∏è Falta crear archivos de utilidades

---

## 2. Variables de Entorno Necesarias

Para evitar duplicaci√≥n, usa estas referencias seg√∫n el orden de trabajo:

- Backend (Supabase, Service Role, Resend, ElevenLabs, Twilio, CRON): ver `ultimo_paso_database_imp.md` (secciones del Job, Webhooks y notas de seguridad; incluye c√≥mo generar `CRON_SECRET`).
- Frontend (NEXT_PUBLIC_* y URL de la app): ver `front_app.md` (secci√≥n de estructura y notas de configuraci√≥n).

Gu√≠a r√°pida: crea `.env.local` en desarrollo, replica en Vercel (Production/Preview) y nunca expongas `SUPABASE_SERVICE_ROLE_KEY` al cliente.

---

## 3. Datos Iniciales en la Base de Datos

### A) Planes de Suscripci√≥n (REQUERIDO)

Sin planes, los usuarios no pueden usar la app. Ejecuta esto en **Supabase SQL Editor**:

```sql
-- Insertar planes de suscripci√≥n
INSERT INTO suscripciones (
  nombre, 
  descripcion, 
  precio_mensual, 
  limite_emails, 
  limite_llamadas, 
  limite_sms, 
  limite_whatsapp, 
  limite_memoria_mb,
  activo
) VALUES
-- Plan B√°sico
(
  'Plan B√°sico', 
  'Ideal para peque√±as empresas que est√°n comenzando', 
  49990,      -- $49.990 CLP
  1000,       -- 1000 emails/mes
  100,        -- 100 llamadas/mes
  500,        -- 500 SMS/mes
  500,        -- 500 WhatsApp/mes
  1024,       -- 1 GB almacenamiento
  true
),
-- Plan Pro
(
  'Plan Pro', 
  'Para empresas en crecimiento con mayor volumen', 
  99990,      -- $99.990 CLP
  5000,       -- 5000 emails/mes
  500,        -- 500 llamadas/mes
  2000,       -- 2000 SMS/mes
  2000,       -- 2000 WhatsApp/mes
  5120,       -- 5 GB almacenamiento
  true
),
-- Plan Enterprise
(
  'Plan Enterprise', 
  'Para grandes empresas sin l√≠mites', 
  199990,     -- $199.990 CLP
  20000,      -- 20000 emails/mes
  2000,       -- 2000 llamadas/mes
  10000,      -- 10000 SMS/mes
  10000,      -- 10000 WhatsApp/mes
  20480,      -- 20 GB almacenamiento
  true
);

-- Verificar que se insertaron
SELECT * FROM suscripciones;
```

---

### B) Configuraciones Globales (Guardrails)

Estas son reglas que aplican a TODOS los usuarios. La l√≥gica de validaci√≥n est√° descrita en `ultimo_paso_database_imp.md` (Guardrails). Aqu√≠ a√±adimos un endpoint m√≠nimo para poblar configuraciones globales desde backend.

**Crear endpoint:** `/app/api/admin/setup-config/route.ts`

```typescript
import { createClient } from '@supabase/supabase-js'
import { NextResponse } from 'next/server'

const supabase = createClient(
  process.env.NEXT_PUBLIC_SUPABASE_URL!,
  process.env.SUPABASE_SERVICE_ROLE_KEY!
)

export async function POST(request: Request) {
  try {
    // Validar que es el admin
    const { userId } = await request.json()
    
    if (userId !== process.env.ADMIN_USER_ID) {
      return NextResponse.json({ error: 'No autorizado' }, { status: 403 })
    }

    // Insertar configuraciones globales
    const { error } = await supabase
      .from('configuraciones')
      .upsert([
        { usuario_id: null, clave: 'max_msgs_deudor_dia', valor: 5 },
        { usuario_id: null, clave: 'max_msgs_deudor_semana', valor: 15 },
        { usuario_id: null, clave: 'max_tipos_por_deudor_semana', valor: 3 },
        { usuario_id: null, clave: 'quiet_hours_start', valor: '21:00' },
        { usuario_id: null, clave: 'quiet_hours_end', valor: '08:00' },
        { usuario_id: null, clave: 'bloquear_domingos', valor: true },
        { usuario_id: null, clave: 'blocked_dates', valor: ['2025-01-01', '2025-05-01', '2025-09-18', '2025-12-25'] }
      ], { onConflict: 'usuario_id,clave' })

    if (error) throw error

    return NextResponse.json({ success: true, message: 'Configuraciones creadas' })
  } catch (error: any) {
    return NextResponse.json({ error: error.message }, { status: 500 })
  }
}
```

**Ejecutar una vez despu√©s de deploy:**
```bash
curl -X POST https://tu-dominio.com/api/admin/setup-config \
  -H "Content-Type: application/json" \
  -d '{"userId":"TU-UUID-ADMIN"}'
```

---

### C) Asignar Plan a Usuario (despu√©s de registro)

**Opci√≥n 1:** Autom√°tico al registrarse (modificar trigger `handle_new_user`):

```sql
CREATE OR REPLACE FUNCTION public.handle_new_user()
RETURNS trigger
LANGUAGE plpgsql
SECURITY DEFINER
SET search_path = public
AS $$
DECLARE
  plan_basico_id uuid;
BEGIN
  IF NEW.email !~ '^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$'
     OR length(NEW.email) > 100
     OR EXISTS (SELECT 1 FROM public.usuarios WHERE id = NEW.id)
  THEN
    RAISE EXCEPTION 'Registro inv√°lido o duplicado';
  END IF;

  -- Obtener ID del plan b√°sico
  SELECT id INTO plan_basico_id 
  FROM suscripciones 
  WHERE nombre = 'Plan B√°sico' 
  LIMIT 1;

  -- Crear usuario con plan b√°sico por defecto
  INSERT INTO public.usuarios (id, email, nombre_empresa, plan_suscripcion_id)
  VALUES (NEW.id, NEW.email, 'Mi Empresa', plan_basico_id);
  
  RETURN NEW;
END;
$$;
```

**Opci√≥n 2:** Manual desde la app (p√°gina de billing).

---

## 4. P√°ginas Faltantes por Implementar

Para estructura de rutas, componentes y ejemplos de UI, consulta `front_app.md`. Aqu√≠ solo listamos lo pendiente con alcance m√≠nimo.

### üî¥ CR√çTICAS (sin estas la app no es usable):

#### A) P√°gina de Campa√±as

**Archivo:** `src/app/campanas/page.tsx`

**Funcionalidad m√≠nima:**
- Listar campa√±as existentes
- Crear campa√±a nueva (b√°sica)
- Ver estado (activa/inactiva)
- Asignar deudas a campa√±a
- Definir tipo (email, llamada, SMS, WhatsApp, mixto)
- Selector de plantilla

**Estructura sugerida:**
```
campanas/
‚îú‚îÄ‚îÄ page.tsx              # Lista de campa√±as
‚îú‚îÄ‚îÄ nueva/
‚îÇ   ‚îî‚îÄ‚îÄ page.tsx          # Crear campa√±a
‚îú‚îÄ‚îÄ [id]/
‚îÇ   ‚îî‚îÄ‚îÄ page.tsx          # Editar campa√±a
‚îî‚îÄ‚îÄ components/
    ‚îú‚îÄ‚îÄ CampanaCard.tsx
    ‚îú‚îÄ‚îÄ CampanaForm.tsx
    ‚îú‚îÄ‚îÄ AsignarDeudas.tsx
    ‚îî‚îÄ‚îÄ ConfiguracionProgramacion.tsx
```

---

#### B) P√°gina de Historial

**Archivo:** `src/app/historial/page.tsx`

**Funcionalidad m√≠nima:**
- Tabla con todas las acciones ejecutadas
- Filtros por:
  - Tipo de acci√≥n (email, llamada, SMS, WhatsApp)
  - Estado (iniciado, completado, fallido)
  - Fecha
  - Deudor
- Ver detalles de cada acci√≥n
- Ver transcripciones de llamadas

**Estructura sugerida:**
```
historial/
‚îú‚îÄ‚îÄ page.tsx
‚îî‚îÄ‚îÄ components/
    ‚îú‚îÄ‚îÄ HistorialTable.tsx
    ‚îú‚îÄ‚îÄ FiltrosHistorial.tsx
    ‚îú‚îÄ‚îÄ DetalleAccion.tsx
    ‚îî‚îÄ‚îÄ TranscripcionLlamada.tsx
```

---

#### C) P√°gina de Plantillas

**Archivo:** `src/app/plantillas/page.tsx`

**Funcionalidad m√≠nima:**
- Listar plantillas por tipo
- Crear plantilla nueva
- Editor de contenido con variables ({{nombre}}, {{monto}}, etc.)
- Preview de plantilla
- Duplicar plantilla

**Estructura sugerida:**
```
plantillas/
‚îú‚îÄ‚îÄ page.tsx              # Lista
‚îú‚îÄ‚îÄ nueva/
‚îÇ   ‚îî‚îÄ‚îÄ page.tsx          # Crear
‚îú‚îÄ‚îÄ [id]/
‚îÇ   ‚îî‚îÄ‚îÄ page.tsx          # Editar
‚îî‚îÄ‚îÄ components/
    ‚îú‚îÄ‚îÄ PlantillaCard.tsx
    ‚îú‚îÄ‚îÄ PlantillaForm.tsx
    ‚îú‚îÄ‚îÄ EditorContenido.tsx
    ‚îú‚îÄ‚îÄ SelectorVariables.tsx
    ‚îî‚îÄ‚îÄ PreviewPlantilla.tsx
```

---

### üü° IMPORTANTES (para app completa):

#### D) P√°gina de Deudor Individual

**Archivo:** `src/app/deudores/[id]/page.tsx`

**Funcionalidad:**
- Ver todos los datos del deudor
- Tabs:
  - Informaci√≥n b√°sica
  - Contactos (lista + agregar/editar)
  - Deudas (lista + agregar/editar/pagar)
  - Historial de acciones
  - Pagos realizados
- Acciones r√°pidas:
  - Enviar email manual
  - Iniciar llamada
  - Registrar pago

---

#### E) P√°gina de Billing/Suscripciones

**Archivo:** `src/app/billing/page.tsx`

**Funcionalidad:**
- Ver plan actual
- Estad√≠sticas de uso (emails enviados, llamadas, etc.)
- L√≠mites del plan
- Cambiar de plan
- Historial de pagos de suscripci√≥n
- M√©todos de pago

**Estructura sugerida:**
```
billing/
‚îú‚îÄ‚îÄ page.tsx
‚îî‚îÄ‚îÄ components/
    ‚îú‚îÄ‚îÄ PlanActual.tsx
    ‚îú‚îÄ‚îÄ EstadisticasUso.tsx
    ‚îú‚îÄ‚îÄ PlanesSuscripcion.tsx
    ‚îú‚îÄ‚îÄ CambiarPlan.tsx
    ‚îî‚îÄ‚îÄ HistorialPagos.tsx
```

---

#### F) P√°gina de Pagos (de deudas)

**Archivo:** `src/app/pagos/page.tsx`

**Funcionalidad:**
- Lista de todos los pagos registrados
- Filtros por fecha, deudor, estado
- Registrar pago manual
- Ver comprobante
- Exportar a CSV/PDF

---

#### G) P√°gina de Tel√©fono/Agentes

**Archivo:** `src/app/telefono/page.tsx`

**Funcionalidad:**
- Gestionar agentes de ElevenLabs
- Ver pool de n√∫meros
- Configurar agente predeterminado
- Ver m√©tricas de llamadas
- Configuraci√≥n de voz (rate, pitch, style)

**Estructura sugerida:**
```
telefono/
‚îú‚îÄ‚îÄ page.tsx
‚îî‚îÄ‚îÄ components/
    ‚îú‚îÄ‚îÄ AgentesLista.tsx
    ‚îú‚îÄ‚îÄ AgenteForm.tsx
    ‚îú‚îÄ‚îÄ NumerosPool.tsx
    ‚îú‚îÄ‚îÄ ConfiguracionVoz.tsx
    ‚îî‚îÄ‚îÄ MetricasLlamadas.tsx
```

---

#### H) P√°gina de Profile

**Archivo:** `src/app/profile/page.tsx`

**Funcionalidad:**
- Editar nombre de empresa
- Cambiar email
- Cambiar contrase√±a
- Configuraciones personales
- Ver API keys (si aplica)

---

### üìä Resumen de p√°ginas:

| P√°gina | Prioridad | Complejidad | Tiempo Estimado |
|--------|-----------|-------------|-----------------|
| Campa√±as | üî¥ Alta | Media | 3-4 d√≠as |
| Historial | üî¥ Alta | Baja | 2-3 d√≠as |
| Plantillas | üî¥ Alta | Media | 2-3 d√≠as |
| Deudor [id] | üü° Media | Alta | 4-5 d√≠as |
| Billing | üü° Media | Media | 3-4 d√≠as |
| Pagos | üü° Media | Baja | 2-3 d√≠as |
| Tel√©fono/Agentes | üü° Media | Media | 3-4 d√≠as |
| Profile | üü¢ Baja | Baja | 1-2 d√≠as |

**Total estimado:** 20-28 d√≠as (4-6 semanas a tiempo completo)

---

## 5. Archivos de Utilidades Faltantes

Para evitar repetir c√≥digo ya documentado:

- Frontend: crea `src/lib/formateo.ts` y `src/lib/ofuscacion.ts` siguiendo `front_app.md` (Funciones de formateo y ofuscaci√≥n).
- Backend: crea `src/lib/guardrails.ts`, `src/lib/reintentos.ts`, `src/lib/rate-limiter.ts` siguiendo `ultimo_paso_database_imp.md` (secciones C2, C1 y C3 respectivamente).

Este documento act√∫a como checklist final: solo verifica que esos archivos existan y pasen lint/build.

---

## 6. Configuraci√≥n de Webhooks Externos

Los pasos detallados para Resend, ElevenLabs y Twilio ya est√°n documentados en `ultimo_paso_database_imp.md` (secci√≥n B). Config√∫ralos all√≠. Aqu√≠ a√±adimos solo un endpoint de verificaci√≥n r√°pida para QA.

---

### D) Verificaci√≥n de Webhooks

Crear endpoint de test para verificar que funcionan:

**Archivo:** `src/app/api/test-webhooks/route.ts`

```typescript
import { NextResponse } from 'next/server'

export async function GET() {
  const status = {
    resend: process.env.RESEND_API_KEY ? '‚úÖ' : '‚ùå',
    elevenlabs: process.env.ELEVENLABS_API_KEY ? '‚úÖ' : '‚ùå',
    twilio: process.env.TWILIO_ACCOUNT_SID && process.env.TWILIO_AUTH_TOKEN ? '‚úÖ' : '‚ùå',
    webhooks: {
      resend_url: `${process.env.NEXT_PUBLIC_APP_URL}/api/webhooks/resend`,
      elevenlabs_url: `${process.env.NEXT_PUBLIC_APP_URL}/api/webhooks/elevenlabs`,
      twilio_url: `${process.env.NEXT_PUBLIC_APP_URL}/api/webhooks/twilio`,
    }
  }

  return NextResponse.json(status)
}
```

Acceder a: `https://tu-dominio.com/api/test-webhooks`

---

## 7. Deployment y Producci√≥n

npm run build
### Gu√≠a m√≠nima (referencia)

- Sigue `ultimo_paso_database_imp.md` para Cron/`vercel.json` y despliegue del Job.
- Instala dependencias, corre `npm run lint` y `npm run build`.
- Configura variables en Vercel (Production/Preview); NO expongas `SUPABASE_SERVICE_ROLE_KEY`.
- Haz deploy (`vercel --prod`) y prueba el endpoint de verificaci√≥n de webhooks (abajo).

### Paso 3: Configurar Dominio (Opcional)

1. En Vercel Dashboard ‚Üí Settings ‚Üí Domains
2. Agregar tu dominio personalizado
3. Configurar DNS seg√∫n instrucciones de Vercel
4. Esperar propagaci√≥n (5-30 minutos)
5. Actualizar `NEXT_PUBLIC_APP_URL` con tu dominio real

---

### Paso 4: Verificar que todo funciona

**Checklist:**
- [ ] App carga en `https://tu-dominio.com`
- [ ] Puedes registrarte y hacer login
- [ ] Se crea autom√°ticamente el perfil en `public.usuarios`
- [ ] Puedes crear un deudor
- [ ] El RUT se normaliza autom√°ticamente
- [ ] Puedes agregar un contacto
- [ ] El job cron est√° activo (ver logs en Vercel)
- [ ] Webhooks est√°n configurados en proveedores

---

### Paso 5: Configurar Monitoreo (Opcional pero recomendado)

#### A) Sentry (errores)

```bash
npm install @sentry/nextjs
npx @sentry/wizard@latest -i nextjs
```

#### B) Vercel Analytics

1. En Vercel Dashboard ‚Üí Analytics
2. Activar (gratis en plan Pro)

#### C) Logs de Cron Job

Verificar en: Vercel Dashboard ‚Üí Deployments ‚Üí Functions ‚Üí Logs

---

## 8. Plan de Implementaci√≥n por Fases

### üìÖ Fase 1: MVP Funcional (2-3 semanas)

**Objetivo:** Tener una app que permita gestionar deudores y enviar mensajes b√°sicos.

#### Semana 1: Infraestructura
- [ ] Configurar TODAS las variables de entorno
- [ ] Crear archivos de utilidades (formateo, ofuscaci√≥n, guardrails, reintentos, rate-limiter)
- [ ] Insertar planes de suscripci√≥n en BD
- [ ] Insertar configuraciones globales
- [ ] Deploy inicial a Vercel
- [ ] Configurar webhooks en proveedores

#### Semana 2: P√°ginas cr√≠ticas
- [ ] Completar p√°gina de Deudores (con contactos y deudas)
- [ ] Implementar p√°gina de Plantillas (b√°sica)
- [ ] Implementar p√°gina de Campa√±as (b√°sica)
- [ ] Implementar p√°gina de Historial (b√°sica)

#### Semana 3: Testing y ajustes
- [ ] Probar flujo completo: registro ‚Üí crear deudor ‚Üí crear campa√±a ‚Üí ejecutar
- [ ] Verificar que el job cron funciona
- [ ] Verificar que los webhooks actualizan el historial
- [ ] Corregir bugs encontrados
- [ ] Documentar uso b√°sico

**Resultado:** App funcional donde puedes gestionar deudores y enviar mensajes autom√°ticos.

---

### üìÖ Fase 2: Producci√≥n Lista (2-3 semanas)

**Objetivo:** Completar todas las funcionalidades para usuarios reales.

#### Semana 4: P√°ginas complementarias
- [ ] Implementar p√°gina de Deudor individual ([id])
- [ ] Implementar p√°gina de Billing/Suscripciones
- [ ] Implementar p√°gina de Pagos
- [ ] Implementar p√°gina de Profile

#### Semana 5: M√≥dulo de llamadas
- [ ] Implementar p√°gina de Tel√©fono/Agentes
- [ ] Gesti√≥n de pool de n√∫meros
- [ ] Configuraci√≥n de voz
- [ ] Ver transcripciones

#### Semana 6: Refinamiento
- [ ] Mejorar UX/UI
- [ ] Agregar validaciones faltantes
- [ ] Optimizar queries
- [ ] Testing exhaustivo
- [ ] Documentaci√≥n completa

**Resultado:** App completa lista para usuarios de pago.

---

### üìÖ Fase 3: Mejoras y Escalabilidad (ongoing)

**Objetivo:** Agregar funcionalidades avanzadas y optimizar.

#### Mejoras UX:
- [ ] Journey builder visual (drag & drop)
- [ ] Dashboard con gr√°ficos (Chart.js o Recharts)
- [ ] Notificaciones en tiempo real
- [ ] B√∫squeda avanzada
- [ ] Exportaciones (CSV, Excel, PDF)

#### Optimizaciones:
- [ ] Cach√© de consultas frecuentes
- [ ] Paginaci√≥n en tablas grandes
- [ ] Lazy loading de componentes
- [ ] Optimizaci√≥n de im√°genes
- [ ] CDN para assets

#### Analytics:
- [ ] Reportes de rendimiento de campa√±as
- [ ] Tasa de apertura/respuesta
- [ ] ROI por canal
- [ ] Predicciones con ML

#### Integraciones:
- [ ] API p√∫blica para integraciones
- [ ] Webhooks personalizados
- [ ] Zapier/Make integration
- [ ] Importaci√≥n desde CRM

---

## 9. Checklist de Implementaci√≥n

### ‚úÖ Base de Datos (100%)
- [x] 20 tablas creadas
- [x] Funciones y triggers
- [x] RLS activado
- [x] √çndices optimizados
- [x] M√≥dulo de llamadas

### üî¥ Configuraci√≥n Inicial (CR√çTICO)
- [ ] Planes de suscripci√≥n insertados
- [ ] Configuraciones globales insertadas
- [ ] Variables de entorno completas
- [ ] ADMIN_USER_ID configurado

### üî¥ Archivos de Utilidades (CR√çTICO)
- [ ] `src/lib/formateo.ts` creado
- [ ] `src/lib/ofuscacion.ts` creado
- [ ] `src/lib/guardrails.ts` creado
- [ ] `src/lib/reintentos.ts` creado
- [ ] `src/lib/rate-limiter.ts` creado

### üî¥ Backend (CR√çTICO)
- [ ] Job cron implementado (`/api/cron/ejecutor-programado`)
- [ ] Webhook Resend (`/api/webhooks/resend`)
- [ ] Webhook ElevenLabs (`/api/webhooks/elevenlabs`)
- [ ] Webhook Twilio (`/api/webhooks/twilio`)

### üî¥ P√°ginas Cr√≠ticas (M√çNIMO VIABLE)
- [ ] Dashboard con estad√≠sticas
- [ ] Deudores completo (lista + crear)
- [ ] Plantillas (lista + crear + editar)
- [ ] Campa√±as (lista + crear b√°sica)
- [ ] Historial (lista con filtros)

### üü° P√°ginas Importantes (COMPLETO)
- [ ] Deudor individual ([id])
- [ ] Billing/Suscripciones
- [ ] Pagos de deudas
- [ ] Tel√©fono/Agentes
- [ ] Profile

### üî¥ Webhooks Externos (CR√çTICO)
- [ ] Resend configurado
- [ ] ElevenLabs configurado
- [ ] Twilio configurado (si usas SMS/WhatsApp)

### üî¥ Deploy (CR√çTICO)
- [ ] Deploy a Vercel exitoso
- [ ] Variables de entorno en Vercel
- [ ] Cron job activo
- [ ] Dominio configurado
- [ ] HTTPS funcionando

### ‚úÖ Testing
- [ ] Registro de usuario funciona
- [ ] Crear deudor funciona
- [ ] RUT se normaliza autom√°ticamente
- [ ] Crear contacto funciona
- [ ] Tel√©fono se normaliza autom√°ticamente
- [ ] Crear deuda funciona
- [ ] RUT se copia autom√°ticamente
- [ ] Crear campa√±a funciona
- [ ] Crear plantilla funciona
- [ ] Job cron ejecuta acciones
- [ ] Webhooks actualizan historial
- [ ] Guardrails bloquean acciones prohibidas

### üü¢ Mejoras Opcionales
- [ ] Journey builder visual
- [ ] Reportes y gr√°ficos
- [ ] Exportaci√≥n de datos
- [ ] Notificaciones push
- [ ] Testing automatizado
- [ ] Documentaci√≥n de API

---

## üéØ Resumen Final

### Con los 3 documentos implementados tendr√°s:

**‚úÖ Core Funcional: 85%**
- Base de datos completa
- Backend operativo
- Frontend b√°sico
- Integraciones listas

**‚ùå Te falta: 15%**
- Configuraciones externas (webhooks, variables)
- Implementar p√°ginas faltantes
- Datos iniciales
- Testing exhaustivo

---

### Tiempo Estimado Total:

| Fase | Tiempo | Resultado |
|------|--------|-----------|
| **Fase 1: MVP** | 2-3 semanas | App funcional b√°sica |
| **Fase 2: Producci√≥n** | 2-3 semanas | App completa |
| **Fase 3: Mejoras** | Ongoing | Optimizaciones |

**Total para MVP:** 2-3 semanas  
**Total para Producci√≥n:** 4-6 semanas

---

### Prioridad de Implementaci√≥n:

1. **HOY:** Variables de entorno + Datos iniciales
2. **D√≠a 1-3:** Archivos de utilidades + Deploy inicial
3. **D√≠a 4-7:** P√°ginas cr√≠ticas (Deudores completo)
4. **Semana 2:** Plantillas + Campa√±as + Historial
5. **Semana 3:** Testing + Ajustes + Webhooks
6. **Semana 4+:** P√°ginas complementarias

---

## üìû ¬øNecesitas Ayuda?

Si tienes dudas durante la implementaci√≥n:

1. **Documentaci√≥n oficial:**
   - Supabase: https://supabase.com/docs
   - Next.js: https://nextjs.org/docs
   - shadcn/ui: https://ui.shadcn.com

2. **Comunidades:**
   - Supabase Discord
   - Next.js Discord
   - Reddit r/nextjs

3. **Este proyecto:**
   - Revisa los logs en Vercel
   - Usa el SQL Editor de Supabase para queries
   - Verifica variables de entorno

---

**√öltima actualizaci√≥n:** Octubre 2025

¬°√âxito con la implementaci√≥n! üöÄ

